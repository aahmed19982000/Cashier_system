{% extends 'base.html' %}
{% load static %}

{% block title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† - ÙØ·Ø§Ø·Ø±ÙŠ Ø§Ù„Ø¨Ø±ÙƒØ©{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/inventory.css' %}">
<style>
    /* ØªØ­Ø³ÙŠÙ† Ø¨Ø³ÙŠØ· Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ ÙÙŠ Ø§Ù„ÙÙ„ØªØ±Ø© */
    .filter-tab {
        text-decoration: none;
        color: inherit;
        display: inline-block;
    }
    .filter-tab.active {
        background-color: var(--primary-color);
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="inventory-container">
    <header class="inventory-header">
        <div class="header-actions">
            <button class="btn-add-item">+ Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</button>
            <button class="btn-export">
                <span>ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ±</span>
                <i class="icon">ğŸ“¥</i>
            </button>
        </div>
        <div class="header-title">
            <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h1>
            <p>ØªØªØ¨Ø¹ ÙƒÙ…ÙŠØ§Øª Ø§Ù„Ø¯Ù‚ÙŠÙ‚ØŒ Ø§Ù„Ø¬Ø¨Ù†ØŒ Ø§Ù„Ù„Ø­ÙˆÙ… ÙˆØ§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰</p>
        </div>
    </header>

    <section class="inventory-stats">
        <div class="stat-card">
            <div class="stat-icon blue">ğŸ“¦</div>
            <div class="stat-info">
                <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙ†Ø§Ù</span>
                <strong class="value">{{ total_items_count }}</strong>
                <small class="trend up">+{{ categories.count }} ÙØ¦Ø§Øª</small>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon red">âš ï¸</div>
            <div class="stat-info">
                <span class="label">Ø£ØµÙ†Ø§Ù Ù…Ù†Ø®ÙØ¶Ø©</span>
                <strong class="value">{{ low_stock_count }}</strong>
                <small class="badge-count">ØªØ­ØªØ§Ø¬ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡</small>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon green">ğŸ’°</div>
            <div class="stat-info">
                <span class="label">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
                <strong class="value">{{ inventory_value|floatformat:0 }} Ø¬.Ù…</strong>
                <small class="trend up">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©</small>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon orange">ğŸ›’</div>
            <div class="stat-info">
                <span class="label">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡</span>
                <strong class="value">{{ low_stock_count }}</strong>
                <small class="trend">ØªÙ†Ø¨ÙŠÙ‡ Ù†Ø´Ø·</small>
            </div>
        </div>
    </section>

    <section class="alert-section">
        <div class="alert-header">
            <a href="?filter=low" class="view-all">Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</a>
            <div class="alert-title">
                <i class="bell-icon">ğŸ””</i>
                <h3>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¹Ø§Ø¬Ù„Ø©: Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶</h3>
            </div>
        </div>
        <div class="alert-cards">
            {% for alert_item in low_stock_items %}
            <div class="alert-card-item">
                <div class="item-icon">
                    {% if "Ø¯Ù‚ÙŠÙ‚" in alert_item.name %}ğŸŒ¾{% elif "Ø¬Ø¨Ù†" in alert_item.name %}ğŸ§€{% else %}ğŸ“¦{% endif %}
                </div>
                <div class="item-progress">
                    <div class="item-name">{{ alert_item.name }}</div>
                    <div class="progress-bar">
                        <div class="progress" style="width: {% widthratio alert_item.quantity alert_item.min_limit 100 %}%; background-color: #e74c3c;"></div>
                    </div>
                    <div class="item-meta">{{ alert_item.quantity }} {{ alert_item.get_unit_display }} Ù…ØªØ¨Ù‚ÙŠ <span>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: {{ alert_item.min_limit }}</span></div>
                </div>
            </div>
            {% empty %}
            <p style="padding: 20px; color: var(--text-gray);">âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙ†Ø§Ù Ù…ØªÙˆÙØ±Ø© Ø¨Ù…Ø³ØªÙˆÙŠØ§Øª Ø¢Ù…Ù†Ø©.</p>
            {% endfor %}
        </div>
    </section>

    <section class="inventory-table-section">
        <div class="table-filters">
            <div class="filter-groups">
                <a href="?" class="filter-tab {% if not selected_category %}active{% endif %}">Ø§Ù„ÙƒÙ„</a>
                {% for cat in categories %}
                <a href="?category={{ cat.id }}" class="filter-tab {% if selected_category == cat.id|stringformat:'i' %}active{% endif %}">
                    {{ cat.name }}
                </a>
                {% endfor %}
            </div>
            <div class="search-box">
                <input type="text" id="inventorySearch" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯...">
                <i class="search-icon">ğŸ”</i>
            </div>
        </div>

        <table class="inventory-table" id="inventoryTable">
            <thead>
                <tr>
                    <th>Ø§Ù„ØµÙ†Ù</th>
                    <th>Ø§Ù„ÙØ¦Ø©</th>
                    <th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</th>
                    <th>Ø­Ø¯ Ø§Ù„Ø·Ù„Ø¨</th>
                    <th>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr class="inventory-row">
                    <td><strong>{{ item.name }}</strong></td>
                    <td>{{ item.category.name }}</td>
                    <td><strong>{{ item.quantity }} {{ item.get_unit_display }}</strong></td>
                    <td>{{ item.min_limit }} {{ item.get_unit_display }}</td>
                    <td>{{ item.updated_at|timesince }}</td>
                    <td>
                        {% if item.is_low %}
                        <span class="status-badge low">Ù…Ù†Ø®ÙØ¶</span>
                        {% else %}
                        <span class="status-badge ok">Ù…ØªÙˆÙØ±</span>
                        {% endif %}
                    </td>
                    <td><button class="btn-update">ØªØ­Ø¯ÙŠØ«</button></td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" style="text-align: center; padding: 30px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙ†Ø§Ù Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù….</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="table-footer">
            <div class="pagination">
                <button class="page-btn">â€¹</button>
                <button class="page-btn">â€º</button>
            </div>
            <div class="table-info">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶: {{ items.count }} ØµÙ†Ù</div>
        </div>
    </section>
</div>

<script>
    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù„Ø­Ø¸ÙŠ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    document.getElementById('inventorySearch').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        const rows = document.querySelectorAll('.inventory-row');
        
        rows.forEach(row => {
            const itemName = row.cells[0].innerText.toLowerCase();
            const itemCategory = row.cells[1].innerText.toLowerCase();
            
            if (itemName.includes(searchTerm) || itemCategory.includes(searchTerm)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}